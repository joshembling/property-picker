(()=>{var h=class{monthlyPayment(e,t,r){let o=t/12/100,n=r*12;return e*(o*(1+o)**n)/((1+o)**n-1)}getMortgageAffordability(e,t=0,r=5,o=25,n,s){let a=this.monthlyPayment(parseInt(e)-t,r,o),d=n-s,m={monthlyPayment:a,finalAmount:(d-a)/d},p={percentage:parseInt((m.finalAmount*100).toFixed())};return{...m,...p}}getRentAffordability(e,t,r){let n=t-r,s=(n-e)/n,a=null;s<.69&&(a=(e/.31000000000000005+r-t)*12);let d={amountLeft:s,targetSalaryNeeded:a},m={percentage:parseInt((d.amountLeft*100).toFixed())};return{...d,...m}}getChromeStorageApplicantValues(e,t,r){return parseInt(e)&&parseInt(t)?parseInt(e)+parseInt(t):parseInt(e)&&!parseInt(t)?parseInt(e):!parseInt(e)&&parseInt(t)?parseInt(t):console.log("calc msg",r)}getCombinedAnnualSalary(e){return this.getChromeStorageApplicantValues(e.annual_salary_0,e.annual_salary_1,"No annual salary entered")}getCombinedMonthlySalary(e){return this.getChromeStorageApplicantValues(e.monthly_salary_after_tax_0,e.monthly_salary_after_tax_1,"No monthly salary entered")}getCombinedDeposit(e){return this.getChromeStorageApplicantValues(e.deposit_value_0,e.deposit_value_1,"No deposit entered")}getMortgagePercentage(e){return parseInt(e.mortgage_percentage)?parseFloat(e.mortgage_percentage):5}getRepaymentTerm(e){return parseInt(e.repayment_term)?parseInt(e.repayment_term):25}createElement(e,t){let r=document.createElement(e);return r.classList.add(t),r}},A=h;var w={CHECK_URL_RIGHTMOVE:300,CHECK_URL_ZOOPLA:1e3,CREATE_FILTERS:800,LOAD_FILTER_FUNCTIONALITY:1500,LOAD_LISTINGS:1e3},i=w;var c=new A,f=class{constructor(){this.pills=[{text:"\u26D4\uFE0F Out of reach",colour:"#fe7f7f"},{text:"\u{1F4AD} Possible but restrictive",colour:"#fba436"},{text:"\u{1F440} Within reach",colour:"#fcfbb8"},{text:"\u2705 Affordable",colour:"#7cffa7"}],this.percentage}getCalculations(e){return{combinedAnnualSalary:c.getCombinedAnnualSalary(e),combinedMonthlySalary:c.getCombinedMonthlySalary(e),combinedDeposit:c.getCombinedDeposit(e),mortgagePercentage:c.getMortgagePercentage(e),repaymentTerm:c.getRepaymentTerm(e)}}getPercentage(e,t){return window.location.href.indexOf("to-rent")>-1?this.percentage=e.percentage:this.percentage=t.percentage}getAffordabilityPercentage(e,t){e===1&&(t.textContent=`Affordability rating: ${this.percentage<=0?"0%":this.percentage>=100?"100%":this.percentage+"%"}`)}getEstimatedMonthlyPayment(e,t,r){e===2&&(t.monthlyPayment<=0?r.remove():r.textContent=`Est. monthly payment: \xA3${t.monthlyPayment.toFixed(2)}`)}getExtraAnnualIncomeNeeded(e,t,r){e===3&&(t.targetSalaryNeeded!==null?r.textContent=`Extra annual income needed: +\xA3${t.targetSalaryNeeded.toLocaleString("en-US",{maximumFractionDigits:0})}`:r.remove())}colourPills(e){this.percentage<50?(e.style.background=this.pills[0].colour,e.textContent=this.pills[0].text,e.classList.add("red")):this.percentage>=50&&this.percentage<65?(e.style.background=this.pills[1].colour,e.textContent=this.pills[1].text,e.classList.add("orange")):this.percentage>=65&&this.percentage<70?(e.style.background=this.pills[2].colour,e.textContent=this.pills[2].text,e.classList.add("yellow")):(e.style.background=this.pills[3].colour,e.textContent=this.pills[3].text,e.classList.add("green"))}colourBackgrounds(e){e.forEach(t=>{t.style.color="#111 !important",this.percentage<50?t.style.background=this.pills[0].colour:this.percentage>=50&&this.percentage<65?t.style.background=this.pills[1].colour:this.percentage>=65&&this.percentage<70?t.style.background=this.pills[2].colour:t.style.background=this.pills[3].colour})}formatListings(e,t,r,o){let n=this.getCalculations(t);if(!isNaN(r)){let s=c.getMortgageAffordability(r,n.combinedDeposit,n.mortgagePercentage,n.repaymentTerm,n.combinedMonthlySalary,0),a=c.getRentAffordability(r,n.combinedMonthlySalary,0);if(n.combinedAnnualSalary!==void 0&&n.combinedMonthlySalary!==void 0){let d=c.createElement("div","pill-wrapper");setTimeout(()=>{e.prepend(d)},i.LOAD_LISTINGS),this.pills.map((m,p)=>{let u=c.createElement("div","pill");d.appendChild(u),u.style.fontSize="0.85rem",window.location.href.indexOf("to-rent")>-1?p===2&&u.remove():p===3&&u.remove(),this.getPercentage(a,s),this.colourPills(u),this.getAffordabilityPercentage(p,u),this.getEstimatedMonthlyPayment(p,s,u),this.getExtraAnnualIncomeNeeded(p,a,u)}),this.colourBackgrounds(o)}}}},y=f;var E=class{constructor(e){this.listing=e}getChildElements(){return this.listing.querySelectorAll(".propertyCard-content *")}changeListingTextToBlack(){this.getChildElements().forEach(e=>{e.style.color="black"})}getListingPrice(){let e=this.listing.querySelector(".propertyCard-priceValue").textContent;return e=e.replace("\xA3",""),e=e.replace(new RegExp(",","g"),""),parseInt(e)}getListingBackgroundElements(){return this.listing.querySelectorAll(".propertyCard-content")}getListingFooterElements(){return this.listing.querySelectorAll(".propertyCard-content div")}},_=E;var L=class{constructor(e){this.listing=e}getChildElements(){return this.listing.querySelectorAll("*")}changeListingTextToBlack(){this.getChildElements().forEach(e=>{e.style.color="black"})}getListingPrice(){let e=this.listing.querySelector('p[data-testid="listing-price"]').textContent;return e=e.replace("\xA3",""),e=e.replace(new RegExp(",","g"),""),parseInt(e)}getListingBackgroundElements(){return this.listing.querySelectorAll("div > div > div:last-child")}},S=L;var x=class{constructor(e,t){this.element=document.querySelector(e),this.provider=t,this.results=[{text:"\u26D4\uFE0F Out of reach",textColour:"red",colour:"#fe7f7f",percentage:"0-49%"},{text:"\u{1F4AD} Possible but restrictive",textColour:"orange",colour:"#fba436",percentage:"50-64%"},{text:"\u{1F440} Within reach",textColour:"yellow",colour:"#fcfbb8",percentage:"65-69%"},{text:"\u2705 Affordable",textColour:"green",colour:"#7cffa7",percentage:"70-100%"}],setTimeout(()=>{this.createElements()},i.CREATE_FILTERS),setTimeout(()=>{this.filterFunctionality()},i.LOAD_FILTER_FUNCTIONALITY)}createElements(){let e=document.createElement("div");e.classList.add("btn-wrapper");let t=this.element.parentElement;t.insertBefore(e,t.children[1]||null),this.results.forEach(r=>{let o=document.createElement("button");o.classList.add("filter-btn"),o.classList.add(r.textColour),o.textContent=r.text,o.style.cssText=`
		    background: ${r.colour};
	    `,o.style.fontFamily="inherit",e.appendChild(o)})}filterFunctionality(){document.querySelectorAll(".filter-btn").forEach(t=>{this.formatButton(t),this.handleButtonEvent(t)})}formatButton(e){chrome.storage.local.get(e.classList[1],t=>{let r=document.querySelectorAll(`.pill.${e.classList[1]}`);t[e.classList[1]]==!1?(e.style.opacity="0.2",r.forEach(o=>{this.provider==="zoopla"?o.parentElement.parentElement.parentElement.classList.add("hide"):o.parentElement.parentElement.classList.add("hide")})):(e.style.opacity="1",r.forEach(o=>{this.provider==="zoopla"?o.parentElement.parentElement.parentElement.classList.remove("hide"):o.parentElement.parentElement.classList.remove("hide")}))})}handleButtonEvent(e){e.addEventListener("click",t=>{chrome.storage.local.get(e.classList[1],n=>{console.log("storage items",n)});let r=t.target.classList[1];t.target.style.opacity!=="0.2"?(t.target.style.opacity="0.2",chrome.storage.local.set({[r]:!1})):(t.target.style.opacity="1",chrome.storage.local.set({[r]:!0})),document.querySelectorAll(`.pill.${r}`).forEach(n=>{this.provider==="zoopla"?n.parentElement.parentElement.parentElement.classList.contains("hide")?(t.target.style.opacity="1",n.parentElement.parentElement.parentElement.classList.remove("hide"),chrome.storage.local.set({[r]:!0})):(t.target.style.opacity="0.2",n.parentElement.parentElement.parentElement.classList.add("hide"),chrome.storage.local.set({[r]:!1})):n.parentElement.parentElement.classList.contains("hide")?(t.target.style.opacity="1",n.parentElement.parentElement.classList.remove("hide"),chrome.storage.local.set({[r]:!0})):(t.target.style.opacity="0.2",n.parentElement.parentElement.classList.add("hide"),chrome.storage.local.set({[r]:!1}))})})}},C=x;var g=window.location.href;function b(){window.location.href!==g?(g=window.location.href,g.includes("__next")?setTimeout(b,i.CHECK_URL_ZOOPLA):window.location.reload()):setTimeout(b,i.CHECK_URL_ZOOPLA)}function v(){(g.includes("for-sale")||g.includes("to-rent"))&&(window.location.href!==g?(g=window.location.href,window.location.reload()):setTimeout(v,i.CHECK_URL_RIGHTMOVE))}g.includes("zoopla")?b():g.includes("rightmove")&&v();var I=document.querySelectorAll("#l-searchResults > div > .l-searchResult ");I.forEach(l=>{l.style.margin="0.75rem 0";let e=new _(l),t=new y;e.changeListingTextToBlack();let r=e.getListingPrice(),o=e.getListingBackgroundElements(),n=e.getListingFooterElements();chrome.storage.local.get(null,function(s){t.formatListings(l,s,r,o),n.forEach(a=>{a.style.color="#111 !important",t.percentage<50?a.style.background=t.pills[0].colour:t.percentage>=50&&t.percentage<65?a.style.background=t.pills[1].colour:t.percentage>=65&&t.percentage<70?a.style.background=t.pills[2].colour:t.percentage>=70&&(a.style.background=t.pills[3].colour)})})});var T=document.querySelectorAll('div[data-testid="regular-listings"] > div > div[id^="listing"]');T.forEach(l=>{let e=new S(l),t=new y;e.changeListingTextToBlack();let r=e.getListingPrice(),o=e.getListingBackgroundElements();chrome.storage.local.get(null,function(n){t.formatListings(l,n,r,o)})});window.location.href.indexOf("zoopla")!=-1&&new C('div[data-testid="search-results-header-control"]',"zoopla");window.location.href.indexOf("rightmove")!=-1&&new C("#keyword-search-container","rightmove");})();
