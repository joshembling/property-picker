(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?t(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function r(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(t){var n=function(t,n){if("object"!==e(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,"string");if("object"!==e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===e(n)?n:String(n)}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==a(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===a(o)?o:String(o)),r)}var o}var c=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"monthlyPayment",value:function(e,t,n){var r=t/12/100,o=12*n;return e*(r*Math.pow(1+r,o))/(Math.pow(1+r,o)-1)}},{key:"getMortgageAffordability",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:25,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,l=this.monthlyPayment(parseInt(e)-t,r,o),c=i-a,u={monthlyPayment:l,finalAmount:(c-l)/c},s={percentage:parseInt((100*u.finalAmount).toFixed())};return n(n({},u),s)}},{key:"getRentAffordability",value:function(e,t,r){var o=t-r,i=(o-e)/o,a=null;i<.69&&(a=12*(e/(1-.69)+r-t));var l={amountLeft:i,targetSalaryNeeded:a},c={percentage:parseInt((100*l.amountLeft).toFixed())};return n(n({},l),c)}},{key:"getChromeStorageApplicantValues",value:function(e,t,n){return parseInt(e)&&parseInt(t)?parseInt(e)+parseInt(t):parseInt(e)&&!parseInt(t)?parseInt(e):!parseInt(e)&&parseInt(t)?parseInt(t):console.log(n)}},{key:"getCombinedAnnualSalary",value:function(e){return this.getChromeStorageApplicantValues(e.annual_salary_0,e.annual_salary_1,"No annual salary entered")}},{key:"getCombinedMonthlySalary",value:function(e){return this.getChromeStorageApplicantValues(e.monthly_salary_after_tax_0,e.monthly_salary_after_tax_1,"No monthly salary entered")}},{key:"getCombinedDeposit",value:function(e){return this.getChromeStorageApplicantValues(e.deposit_value_0,e.deposit_value_1,"No deposit entered")}},{key:"getMortgagePercentage",value:function(e){return parseInt(e.mortgage_percentage)?parseFloat(e.mortgage_percentage):5}},{key:"getRepaymentTerm",value:function(e){return parseInt(e.repayment_term)?parseInt(e.repayment_term):25}},{key:"createElement",value:function(e,t){var n=document.createElement(e);return n.classList.add(t),n}}],r&&o(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}());const u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pills=[{text:"⛔️ Out of reach",colour:"#fe7f7f"},{text:"💭 Possible but restrictive",colour:"#fba436"},{text:"👀 Within reach",colour:"#fcfbb8"},{text:"✅ Affordable",colour:"#7cffa7"}],this.percentage}var t,n;return t=e,(n=[{key:"getCalculations",value:function(e){return{combinedAnnualSalary:c.getCombinedAnnualSalary(e),combinedMonthlySalary:c.getCombinedMonthlySalary(e),combinedDeposit:c.getCombinedDeposit(e),mortgagePercentage:c.getMortgagePercentage(e),repaymentTerm:c.getRepaymentTerm(e)}}},{key:"getPercentage",value:function(e,t){return window.location.href.indexOf("to-rent")>-1?this.percentage=e.percentage:this.percentage=t.percentage}},{key:"getAffordabilityPercentage",value:function(e,t){1===e&&(t.textContent="Affordability rating: ".concat(this.percentage<=0?"0%":this.percentage>=100?"100%":this.percentage+"%"))}},{key:"getEstimatedMonthlyPayment",value:function(e,t,n){2===e&&(t.monthlyPayment<=0?n.remove():n.textContent="Est. monthly payment: £".concat(t.monthlyPayment.toFixed(2)))}},{key:"getExtraAnnualIncomeNeeded",value:function(e,t,n){3===e&&(null!==t.targetSalaryNeeded?n.textContent="Extra annual income needed: +£".concat(t.targetSalaryNeeded.toLocaleString("en-US",{maximumFractionDigits:0})):n.remove())}},{key:"colourPills",value:function(e){this.percentage<50?(e.style.background=this.pills[0].colour,e.textContent=this.pills[0].text,e.classList.add("red")):this.percentage>=50&&this.percentage<65?(e.style.background=this.pills[1].colour,e.textContent=this.pills[1].text,e.classList.add("orange")):this.percentage>=65&&this.percentage<70?(e.style.background=this.pills[2].colour,e.textContent=this.pills[2].text,e.classList.add("yellow")):(e.style.background=this.pills[3].colour,e.textContent=this.pills[3].text,e.classList.add("green"))}},{key:"colourBackgrounds",value:function(e){var t=this;e.forEach((function(e){e.style.color="#111 !important",t.percentage<50?e.style.background=t.pills[0].colour:t.percentage>=50&&t.percentage<65?e.style.background=t.pills[1].colour:t.percentage>=65&&t.percentage<70?e.style.background=t.pills[2].colour:e.style.background=t.pills[3].colour}))}},{key:"formatListings",value:function(e,t,n,r){var o=this,i=this.getCalculations(t);if(!isNaN(n)){var a=c.getMortgageAffordability(n,i.combinedDeposit,i.mortgagePercentage,i.repaymentTerm,i.combinedMonthlySalary,0),l=c.getRentAffordability(n,i.combinedMonthlySalary,0);if(void 0!==i.combinedAnnualSalary&&void 0!==i.combinedMonthlySalary){var u=c.createElement("div","pill-wrapper");e.prepend(u),this.pills.map((function(e,t){var n=c.createElement("div","pill");u.appendChild(n),n.style.fontSize="0.85rem",window.location.href.indexOf("to-rent")>-1?2===t&&n.remove():3===t&&n.remove(),o.getPercentage(l,a),o.colourPills(n),o.getAffordabilityPercentage(t,n),o.getEstimatedMonthlyPayment(t,a,n),o.getExtraAnnualIncomeNeeded(t,l,n)})),this.colourBackgrounds(r)}}}}])&&l(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==s(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===s(o)?o:String(o)),r)}var o}const y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listing=t}var t,n;return t=e,(n=[{key:"getChildElements",value:function(){return this.listing.querySelectorAll(".propertyCard-content *")}},{key:"changeListingTextToBlack",value:function(){this.getChildElements().forEach((function(e){e.style.color="black"}))}},{key:"getListingPrice",value:function(){var e=this.listing.querySelector(".propertyCard-priceValue").textContent;return e=(e=e.replace("£","")).replace(new RegExp(",","g"),""),parseInt(e)}},{key:"getListingBackgroundElements",value:function(){return this.listing.querySelectorAll(".propertyCard-content")}},{key:"getListingFooterElements",value:function(){return this.listing.querySelectorAll(".propertyCard-content div")}}])&&f(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==p(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==p(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===p(o)?o:String(o)),r)}var o}const m=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listing=t}var t,n;return t=e,(n=[{key:"getChildElements",value:function(){return this.listing.querySelectorAll("*")}},{key:"changeListingTextToBlack",value:function(){this.getChildElements().forEach((function(e){e.style.color="black"}))}},{key:"getListingPrice",value:function(){var e=this.listing.querySelector('p[data-testid="listing-price"]').textContent;return e=(e=e.replace("£","")).replace(new RegExp(",","g"),""),parseInt(e)}},{key:"getListingBackgroundElements",value:function(){return this.listing.querySelectorAll("div > div > div:first-of-type > div:nth-child(2) > div:first-of-type > a:first-of-type > div:first-of-type")}}])&&g(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function b(e,t,n){return(t=v(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,v(r.key),r)}}function v(e){var t=function(e,t){if("object"!==d(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==d(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===d(t)?t:String(t)}const w=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=document.querySelector(t),this.results=[{text:"⛔️ Out of reach",textColour:"red",colour:"#fe7f7f",percentage:"0-49%"},{text:"💭 Possible but restrictive",textColour:"orange",colour:"#fba436",percentage:"50-64%"},{text:"👀 Within reach",textColour:"yellow",colour:"#fcfbb8",percentage:"65-69%"},{text:"✅ Affordable",textColour:"green",colour:"#7cffa7",percentage:"70-100%"}],this.createElements(),this.filterFunctionality()}var t,n;return t=e,(n=[{key:"createElements",value:function(){var e=document.createElement("div");e.classList.add("btn-wrapper"),this.element.parentElement.appendChild(e),this.results.forEach((function(t){var n=document.createElement("button");n.classList.add("filter-btn"),n.classList.add(t.textColour),n.textContent=t.text,n.style.cssText="\n\t\tbackground: ".concat(t.colour,";\n\t  "),e.appendChild(n)}))}},{key:"filterFunctionality",value:function(){var e=this;document.querySelectorAll(".filter-btn").forEach((function(t){e.formatButton(t),e.handleButtonEvent(t)}))}},{key:"formatButton",value:function(e){chrome.storage.local.get(e.classList[1],(function(t){console.log(t);var n=document.querySelectorAll(".pill.".concat(e.classList[1]));!1===t[e.classList[1]]?(e.style.opacity="0.2",n.forEach((function(e){e.parentElement.parentElement.classList.add("hide")}))):(e.style.opacity="1",n.forEach((function(e){e.parentElement.parentElement.classList.remove("hide")})))}))}},{key:"handleButtonEvent",value:function(e){e.addEventListener("click",(function(t){console.log(t.target),"0.2"!==t.target.style.opacity?(t.target.style.opacity="0.2",chrome.storage.local.set(b({},n,!1))):(t.target.style.opacity="1",chrome.storage.local.set(b({},n,!0))),chrome.storage.local.get(e.classList[1],(function(e){console.log(e)}));var n=t.target.classList[1];document.querySelectorAll(".pill.".concat(n)).forEach((function(e){e.parentElement.parentElement.classList.contains("hide")?(t.target.style.opacity="1",e.parentElement.parentElement.classList.remove("hide"),chrome.storage.local.set(b({},n,!0))):(t.target.style.opacity="0.2",e.parentElement.parentElement.classList.add("hide"),chrome.storage.local.set(b({},n,!1)))}))}))}}])&&h(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();var S=window.location.href;S.includes("zoopla")?function e(){window.location.href!==S?(S=window.location.href).includes("__next")?setTimeout(e,100):window.location.reload():setTimeout(e,100)}():S.includes("rightmove")&&function e(){(S.includes("for-sale")||S.includes("to-rent"))&&(window.location.href!==S?(S=window.location.href,window.location.reload()):setTimeout(e,300))}(),document.querySelectorAll("#l-searchResults > div > .l-searchResult ").forEach((function(e){e.style.margin="0.75rem 0";var t=new y(e),n=new u;t.changeListingTextToBlack();var r=t.getListingPrice(),o=t.getListingBackgroundElements(),i=t.getListingFooterElements();chrome.storage.local.get(null,(function(t){n.formatListings(e,t,r,o),i.forEach((function(e){e.style.color="#111 !important",n.percentage<50?e.style.background=n.pills[0].colour:n.percentage>=50&&n.percentage<65?e.style.background=n.pills[1].colour:n.percentage>=65&&n.percentage<70?e.style.background=n.pills[2].colour:n.percentage>=70&&(e.style.background=n.pills[3].colour)}))}))})),document.querySelectorAll('div[data-testid="regular-listings"] > div[id^="listing"]').forEach((function(e){var t=new m(e),n=new u;t.changeListingTextToBlack();var r=t.getListingPrice(),o=t.getListingBackgroundElements();chrome.storage.local.get(null,(function(t){n.formatListings(e,t,r,o)}))})),-1!=window.location.href.indexOf("zoopla")&&new w('h1[data-testid="results-title"]'),-1!=window.location.href.indexOf("rightmove")&&new w("#keyword-search-container")})();