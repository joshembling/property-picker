(()=>{var f=class{monthlyPayment(e,t,r){let n=t/12/100,o=r*12;return e*(n*(1+n)**o)/((1+n)**o-1)}getMortgageAffordability(e,t=0,r=5,n=25,o,s){let a=this.monthlyPayment(parseInt(e)-t,r,n),u=o-s,m={monthlyPayment:a,finalAmount:(u-a)/u},d={percentage:parseInt((m.finalAmount*100).toFixed())};return{...m,...d}}getRentAffordability(e,t,r){let o=t-r,s=(o-e)/o,a=null;s<.69&&(a=(e/.31000000000000005+r-t)*12);let u={amountLeft:s,targetSalaryNeeded:a},m={percentage:parseInt((u.amountLeft*100).toFixed())};return{...u,...m}}getChromeStorageApplicantValues(e,t,r){return parseInt(e)&&parseInt(t)?parseInt(e)+parseInt(t):parseInt(e)&&!parseInt(t)?parseInt(e):!parseInt(e)&&parseInt(t)?parseInt(t):console.log("calc msg",r)}getCombinedAnnualSalary(e){return this.getChromeStorageApplicantValues(e.annual_salary_0,e.annual_salary_1,"No annual salary entered")}getCombinedMonthlySalary(e){return this.getChromeStorageApplicantValues(e.monthly_salary_after_tax_0,e.monthly_salary_after_tax_1,"No monthly salary entered")}getCombinedDeposit(e){return this.getChromeStorageApplicantValues(e.deposit_value_0,e.deposit_value_1,"No deposit entered")}getMortgagePercentage(e){return parseInt(e.mortgage_percentage)?parseFloat(e.mortgage_percentage):5}getRepaymentTerm(e){return parseInt(e.repayment_term)?parseInt(e.repayment_term):25}createElement(e,t){let r=document.createElement(e);return r.classList.add(t),r}},A=f;var I={CHECK_URL_RIGHTMOVE:300,CHECK_URL_ZOOPLA:1e3,CREATE_FILTERS:800,LOAD_FILTER_FUNCTIONALITY:1500,LOAD_LISTINGS:1e3},i=I;var c=new A,h=class{constructor(){this.pills=[{text:"\u26D4\uFE0F Out of reach",colour:"#fe7f7f"},{text:"\u{1F4AD} Possible but restrictive",colour:"#fba436"},{text:"\u{1F440} Within reach",colour:"#fcfbb8"},{text:"\u2705 Affordable",colour:"#7cffa7"}],this.percentage}getCalculations(e){return{combinedAnnualSalary:c.getCombinedAnnualSalary(e),combinedMonthlySalary:c.getCombinedMonthlySalary(e),combinedDeposit:c.getCombinedDeposit(e),mortgagePercentage:c.getMortgagePercentage(e),repaymentTerm:c.getRepaymentTerm(e)}}getPercentage(e,t){return window.location.href.indexOf("to-rent")>-1?this.percentage=e.percentage:this.percentage=t.percentage}getAffordabilityPercentage(e,t){e===1&&(t.textContent=`Affordability rating: ${this.percentage<=0?"0%":this.percentage>=100?"100%":this.percentage+"%"}`)}getEstimatedMonthlyPayment(e,t,r){e===2&&(t.monthlyPayment<=0?r.remove():r.textContent=`Est. monthly payment: \xA3${t.monthlyPayment.toFixed(2)}`)}getExtraAnnualIncomeNeeded(e,t,r){e===3&&(t.targetSalaryNeeded!==null?r.textContent=`Extra annual income needed: +\xA3${t.targetSalaryNeeded.toLocaleString("en-US",{maximumFractionDigits:0})}`:r.remove())}colourPills(e){this.percentage<50?(e.style.background=this.pills[0].colour,e.textContent=this.pills[0].text,e.classList.add("red")):this.percentage>=50&&this.percentage<65?(e.style.background=this.pills[1].colour,e.textContent=this.pills[1].text,e.classList.add("orange")):this.percentage>=65&&this.percentage<70?(e.style.background=this.pills[2].colour,e.textContent=this.pills[2].text,e.classList.add("yellow")):(e.style.background=this.pills[3].colour,e.textContent=this.pills[3].text,e.classList.add("green"))}colourBackgrounds(e){e.forEach(t=>{t.style.color="#111 !important",this.percentage<50?t.style.background=this.pills[0].colour:this.percentage>=50&&this.percentage<65?t.style.background=this.pills[1].colour:this.percentage>=65&&this.percentage<70?t.style.background=this.pills[2].colour:t.style.background=this.pills[3].colour})}formatListings(e,t,r,n){let o=this.getCalculations(t);if(!isNaN(r)){let s=c.getMortgageAffordability(r,o.combinedDeposit,o.mortgagePercentage,o.repaymentTerm,o.combinedMonthlySalary,0),a=c.getRentAffordability(r,o.combinedMonthlySalary,0);if(o.combinedAnnualSalary!==void 0&&o.combinedMonthlySalary!==void 0){let u=c.createElement("div","pill-wrapper");setTimeout(()=>{e.prepend(u)},i.LOAD_LISTINGS),this.pills.map((m,d)=>{let p=c.createElement("div","pill");u.appendChild(p),p.style.fontSize="0.85rem",window.location.href.indexOf("to-rent")>-1?d===2&&p.remove():d===3&&p.remove(),this.getPercentage(a,s),this.colourPills(p),this.getAffordabilityPercentage(d,p),this.getEstimatedMonthlyPayment(d,s,p),this.getExtraAnnualIncomeNeeded(d,a,p)}),this.colourBackgrounds(n)}}}},y=h;var E=class{constructor(e){this.listing=e}getChildElements(){return this.listing.querySelectorAll(".propertyCard-content *")}changeListingTextToBlack(){this.getChildElements().forEach(e=>{e.style.color="black"})}getListingPrice(){let e=this.listing.querySelector(".propertyCard-priceValue").textContent;return e=e.replace("\xA3",""),e=e.replace(new RegExp(",","g"),""),parseInt(e)}getListingBackgroundElements(){return this.listing.querySelectorAll(".propertyCard-content")}getListingFooterElements(){return this.listing.querySelectorAll(".propertyCard-content div")}},_=E;var L=class{constructor(e){this.listing=e}getChildElements(){return this.listing.querySelectorAll("*")}changeListingTextToBlack(){this.getChildElements().forEach(e=>{e.style.color="black"})}getListingPrice(){let e=this.listing.querySelector('p[data-testid="listing-price"]').textContent;return e=e.replace("\xA3",""),e=e.replace(new RegExp(",","g"),""),parseInt(e)}getListingBackgroundElements(){return this.listing.querySelectorAll("div > div > div:last-child")}},S=L;var x=class{constructor(e){this.element=document.querySelector(e),this.results=[{text:"\u26D4\uFE0F Out of reach",textColour:"red",colour:"#fe7f7f",percentage:"0-49%"},{text:"\u{1F4AD} Possible but restrictive",textColour:"orange",colour:"#fba436",percentage:"50-64%"},{text:"\u{1F440} Within reach",textColour:"yellow",colour:"#fcfbb8",percentage:"65-69%"},{text:"\u2705 Affordable",textColour:"green",colour:"#7cffa7",percentage:"70-100%"}],setTimeout(()=>{this.createElements()},i.CREATE_FILTERS),setTimeout(()=>{this.filterFunctionality()},i.LOAD_FILTER_FUNCTIONALITY)}createElements(){let e=document.createElement("div");e.classList.add("btn-wrapper");let t=this.element.parentElement;t.insertBefore(e,t.children[1]||null),this.results.forEach(r=>{let n=document.createElement("button");n.classList.add("filter-btn"),n.classList.add(r.textColour),n.textContent=r.text,n.style.cssText=`
		    background: ${r.colour};
	    `,n.style.fontFamily="inherit",e.appendChild(n)})}filterFunctionality(){document.querySelectorAll(".filter-btn").forEach(t=>{this.formatButton(t),this.handleButtonEvent(t)})}formatButton(e){chrome.storage.local.get(e.classList[1],t=>{let r=document.querySelectorAll(`.pill.${e.classList[1]}`);t[e.classList[1]]==!1?(e.style.opacity="0.2",r.forEach(n=>{n.parentElement.parentElement.classList.add("hide")})):(e.style.opacity="1",r.forEach(n=>{n.parentElement.parentElement.classList.remove("hide")}))})}handleButtonEvent(e){e.addEventListener("click",t=>{t.target.style.opacity!=="0.2"?(t.target.style.opacity="0.2",chrome.storage.local.set({[r]:!1})):(t.target.style.opacity="1",chrome.storage.local.set({[r]:!0})),chrome.storage.local.get(e.classList[1],o=>{console.log("storage items",o)});let r=t.target.classList[1];document.querySelectorAll(`.pill.${r}`).forEach(o=>{o.parentElement.parentElement.classList.contains("hide")?(t.target.style.opacity="1",o.parentElement.parentElement.classList.remove("hide"),chrome.storage.local.set({[r]:!0})):(t.target.style.opacity="0.2",o.parentElement.parentElement.classList.add("hide"),chrome.storage.local.set({[r]:!1}))})})}},C=x;var g=window.location.href;function b(){window.location.href!==g?(g=window.location.href,g.includes("__next")?setTimeout(b,i.CHECK_URL_ZOOPLA):window.location.reload()):setTimeout(b,i.CHECK_URL_ZOOPLA)}function w(){(g.includes("for-sale")||g.includes("to-rent"))&&(window.location.href!==g?(g=window.location.href,window.location.reload()):setTimeout(w,i.CHECK_URL_RIGHTMOVE))}g.includes("zoopla")?b():g.includes("rightmove")&&w();var T=document.querySelectorAll("#l-searchResults > div > .l-searchResult ");T.forEach(l=>{l.style.margin="0.75rem 0";let e=new _(l),t=new y;e.changeListingTextToBlack();let r=e.getListingPrice(),n=e.getListingBackgroundElements(),o=e.getListingFooterElements();chrome.storage.local.get(null,function(s){t.formatListings(l,s,r,n),o.forEach(a=>{a.style.color="#111 !important",t.percentage<50?a.style.background=t.pills[0].colour:t.percentage>=50&&t.percentage<65?a.style.background=t.pills[1].colour:t.percentage>=65&&t.percentage<70?a.style.background=t.pills[2].colour:t.percentage>=70&&(a.style.background=t.pills[3].colour)})})});var v=document.querySelectorAll('div[data-testid="regular-listings"] > div > div[id^="listing"]');v.forEach(l=>{let e=new S(l),t=new y;e.changeListingTextToBlack();let r=e.getListingPrice(),n=e.getListingBackgroundElements();chrome.storage.local.get(null,function(o){t.formatListings(l,o,r,n)})});window.location.href.indexOf("zoopla")!=-1&&new C('div[data-testid="search-results-header-control"]');window.location.href.indexOf("rightmove")!=-1&&new C("#keyword-search-container");})();
